\section{The Matrix element method}
\label{sec:mem}

The MEM computes probability densities (PDs) $w_{i}(\vecy)$
for obtaining the measured observables $\vecy$, assuming that the event has been produced by the process $i$.
The PDs $w_{i}(\vecy)$ are interpreted as quantifying the compatibility of the measured observables $\vecy$
with the signal ($i=0$) and background ($i=1$) hypothesis.
In the analysis of $\PHiggs\PHiggs$ production in the decay channel 
$\PHiggs\PHiggs \to \Pbottom\APbottom\PW\PW\virt \to \Pbottom\APbottom \, \ellPlusnu\ellMinusnu$
the observables $\vecy$ refer to 
the measured momenta of the two $\Pbottom$-jets, of the two charged leptons, and of the measured missing transverse momentum ($\vecMET$) in the event.
The vector $\vecMET$ represents the measured value of the vectorial sum of the two neutrino momenta in the plane transverse to the beam axis.
We use symbols with a hat to denote the true values of energies and momenta.
Bold letters denote vector quantities.
The vector $\vecyhat$ denotes the true values of the $\Pbottom$-jet and charged lepton momenta and the true values of the momenta of the two neutrinos produced in the $\PW$ boson decays.

As already mentioned, $\PHiggs\PHiggs \to \Pbottom\APbottom\PW\PW\virt \to \Pbottom\APbottom \, \ellPlusnu\ellMinusnu$ signal events
contain the same number of $\Pbottom$-jets, charged leptons, and neutrinos as the dominant background,
arising from $\ttbar \to \Pbottom\PW\APbottom\PW \to \Pbottom\ellPlusnu \, \APbottom\ellMinusnu$.
The separation of the $\PHiggs\PHiggs$ signal from the irreducible $\ttbar$ background is based on the difference in event kinematics,
causing the PD $w_{0}(\vecy)$ to be in general higher when evaluated on signal events
and lower when evaluated on background events, and vice versa for the PD $w_{1}(\vecy)$.
Given the PDs $w_{0}(\vecy)$ and $w_{1}(\vecy)$ for the signal and background hypotheses,
the Neyman-Pearson lemma~\cite{Neyman:1933wgr} postulates that the likelihood ratio (LR):
\begin{linenowrapper}
\begin{equation}
P(\vecy) = \frac{w_{0}(\vecy)}{w_{0}(\vecy) + w_{1}(\vecy)}
\label{eq:memLR}
\end{equation}
\end{linenowrapper}
provides the optimal separation of the $\PHiggs\PHiggs$ signal from the irreducible $\ttbar$ background.

Different nomenclatures and conventions for the MEM exist in the literature.
In this note, we follow the nomenclature and conventions introduced in Ref.~\cite{Volobouev:2011vb}.
The PDs $w_{i}(\vecy)$ are given by the integral:
\begin{linenowrapper}
\begin{align}
w_{i}(\vecy) = & \frac{\Omega(\vecy)}{\sigma_{i} \cdot \mathcal{A}_{i}} \, \int \, d\xhat_{a} \, d\xhat_{b} \,
  d\Phi_{n} \, \frac{f(\xhat_{a}, Q) \, f(\xhat_{b}, Q)}{2 \, \xhat_{a} \, \xhat_{b} \, s} \, (2\pi)^{4} \,
  \delta\left( \xhat_{a} \, \Ehat_{a} + \xhat_{b} \, \Ehat_{b} - \sum_{k}^{n} \Ehat_{(k)} \right) \nonumber \\
 & \quad \cdot \, \delta^{3}\left( \xhat_{a} \, \vecphat^{a} + \xhat_{b} \, \vecphat^{b} - \sum_{k}^{n} \vecphat^{(k)}\right) \, 
  \vert \mathcal{M}_{i}(\vecyhat) \vert^{2} \, W(\vecy|\vecyhat) \, \epsilon_{i}(\vecyhat) \, .
\label{eq:mem1}
\end{align}
\end{linenowrapper}
The symbol $\vert \mathcal{M}_{i}(\vecyhat) \vert^{2}$ denotes the squared modulus of the matrix element (ME),
averaged over helicity states,
for either the signal ($i=0$) or for the background ($i=1$) hypothesis.
We use ME generated at LO accuracy with the program $\textsc{MadGraph\_aMCatNLO}$ $2.3.3$~\cite{MadGraph_aMCatNLO} for the signal as well as for the background hypothesis.
The ME for the signal hypothesis is generated using the infinite top quark mass approximation~\cite{Grinstein:2007iv}.
In this approximation, the top quark degrees of freedom are integrated out,
replacing the top quark loops in the triangle and box diagrams shown in Fig.~\ref{fig:ggHH_FeynmanDiagram} by point-like effective couplings of, respectively, 
two gluons to one $\PHiggs$ boson and two gluons to two $\PHiggs$ bosons.
The point-like effective couplings are specified via a Universal $\textsc{FeynRules}$ Output (UFO) model file~\cite{Degrande:2011ua,Hespel:2014sla} given to $\textsc{MadGraph\_aMCatNLO}$.
The usage of the infinite top quark mass approximation is necessary, because at present the program $\textsc{MadGraph\_aMCatNLO}$ does not support the generation of ME code for processes involving loops.
%Our choice of using LO ME is motivated by the observation that using ME generated at NLO accuracy in pQCD
%would increase the computing-time requirements of the MEM by one to two orders of magnitude. 
%As we will discuss in more detail in Section~\ref{sec:computing_time_requirements}, the demand in computing time is challenging already when using ME generated at LO accuracy.

The symbols $\Ehat_{a}$ and $\Ehat_{b}$ ($\vecphat^{a}$ and $\vecphat^{b}$) denote the energies (momenta) of the two colliding protons,
$\sqrt{s}$ their center-of-mass energy,
$\xhat_{a}$ and $\xhat_{b}$ the Bjorken scaling variables~\cite{Bjorkenx},
and $f(\xhat_{a}, Q)$ and $f(\xhat_{b}, Q)$ the corresponding parton distribution functions (PDFs)~\cite{LHAPDF}.
Besides their dependence on the Bjorken scaling variables, 
the PDFs depend on a scale parameter $Q$.
We use the \textrm{MSTW} 2008 LO PDF set~\cite{MSTW} to evaluate $f(\xhat_{a}, Q)$ and $f(\xhat_{b}, Q)$
and set the scale $Q$ to half the mass of the $\PHiggs\PHiggs$ system and to twice the value of the top quark mass
when computing the PD $w_{0}(\vecy)$ and $w_{1}(\vecy)$ for the signal and background hypothesis, respectively.
We denote by $n$ the number of particles in the final state,
and by $\vecp^{(k)}$ ($\vecphat^{(k)}$) the measured (true) momentum of the $k$-th final state particle. 
The $\delta$-functions $\delta( \xhat_{a} \, \Ehat_{a} + \xhat_{b} \, \Ehat_{b} - \sum_{k}^{n} \Ehat_{(k)})$
and $\delta^{3}( \xhat_{a} \, \vecphat^{a} + \xhat_{b} \, \vecphat^{b} - \sum_{k}^{n} \vecphat^{(k)})$ 
impose conservation of energy and momentum.

The functions $W(\vecy|\vecyhat)$ are referred to as ``transfer functions'' (TF) in the literature.
They represent the PD to observe the measured values $\vecy$, given the true values $\vecyhat$.
The function $\Omega(\vecy)$ is referred to as ``indicator function'' in the literature~\cite{Fiedler:2010sg,Volobouev:2011vb}.
It attains the value $1$ in case the event represented by the measured observables $\vecy$ passes the event selection criteria and otherwise attains the value $0$.
The efficiency for an event originating at the phase-space (PS) point
$\vecyhat$ to pass the event selection, \ie to end up with measured
observables $\vecy$ for which $\Omega(\vecy) = 1$,
is denoted by $\epsilon_{i}(\vecyhat)$. 
Finally, the symbol $\mathcal{A}_{i}$ denotes the acceptance of the event selection, 
that is, the percentage of events which pass the event selection criteria,
while $\sigma_{i}$ denotes the cross section of process $i$.
The subscript $i$ of the symbols $\sigma_{i}$, $\mathcal{A}_{i}$, and $\epsilon_{i}$ 
emphasize that the cross section, acceptance, and efficiency differ between the signal and the background hypothesis.
Division of the right-hand-side (RHS) of Eq.~(\ref{eq:mem1}) by the product $\sigma_{i} \cdot \mathcal{A}_{i}$
ensures that $w_{i}(\vecy)$ has the correct normalization required for a probability density, 
\ie $\int \, d\vecy \, w_{i}(\vecy) = 1$,
provided that the TF satisfy the normalization condition
$\int \, d\vecy \, \Omega(\vecy) \, W(\vecy|\vecyhat) = 1$
for every $\vecyhat$.

The symbol $d\Phi_{n} = \prod_{k}^{n} \, \frac{d^{3}\vecphat^{(k)}}{(2\pi)^{3} \, 2 \Ehat_{(k)}}$ 
represents the differential $n$-particle PS element.
For the $\PHiggs\PHiggs$ signal 
as well as for the $\ttbar$ background hypothesis, $n=6$.  
We express the PS element $d\Phi_{6}$ in terms of the energies $\Ehat_{(k)}$, the polar angles $\thetahat_{(k)}$, and the azimuthal angles $\phihat_{(k)}$ 
of the two $\Pbottom$ quarks, of the two charged leptons, and of the two neutrinos:
\begin{linenowrapper}
\begin{eqnarray}
d\Phi_{6} 
 & = &\prod_{k}^{6} \, \frac{d^{3}\vecphat^{(k)}}{(2 \, \pi)^{3} \, 2 \, \Ehat_{(k)}} 
  = \frac{1}{2^{24} \, \pi^{18}} \, \prod_{k}^{6} \, 
\frac{d^{3}\vecphat^{(k)}}{\Ehat_{(k)}} \nonumber \\
 & = & \frac{1}{2^{24} \, \pi^{18}} \, \prod_{k}^{6} \, 
\frac{d\Ehat_{(k)} \, d\thetahat_{(k)} \, d\phihat_{(k)} \, |\vecphat^{(k)}| \, \Ehat_{(k)} \, \sin\thetahat_{(k)}}{\Ehat_{(k)}} \nonumber \\
 & = & \frac{1}{2^{24} \, \pi^{18}} \, \prod_{k}^{6} \, 
d\Ehat_{(k)} \, d\thetahat_{(k)} \, d\phihat_{(k)} \, \betahat_{(k)} \Ehat_{(k)} \, \sin\thetahat_{(k)} \, .
\label{eq:PS_inPolarCoordinates}
\end{eqnarray}
\end{linenowrapper}
All energies $\Ehat_{(k)}$ as well as the angles $\thetahat_{(k)}$ and $\phihat_{(k)}$ refer to the laboratory (detector) frame.
The velocity $\betahat_{(k)}$ of particle $k$,
given by $\betahat_{(k)} \equiv \frac{|\vecphat^{(k)}|}{\Ehat_{(k)}}$,
has been used to simplify the expression for $d\Phi_{6}$ in the last step.
Note that the velocity $\betahat_{(k)}$ is a function of energy $\Ehat_{(k)}$ and hence cannot be treated as constant when evaluating the integral over $d\Ehat_{(k)}$.
Similarly, the magnitude of the momentum $|\vecphat^{(k)}|$ is a function of the energy $\Ehat_{(k)}$.
In the following, we use the identities $|\vecphat^{(k)}| = \sqrt{\Ehat_{(k)}^{2} - m_{(k)}^{2}}$ 
and $\betahat_{(k)} = \frac{\sqrt{\Ehat_{(k)}^{2} - m_{(k)}^{2}}}{\Ehat_{(k)}}$ to make the dependency on the energy $\Ehat_{(k)}$ explicit.

The form of Eq.~(\ref{eq:PS_inPolarCoordinates}) is useful, 
as it allows to trivially perform the integration over the 
angles $\thetahat_{(k)}$ and $\phihat_{(k)}$ for the two $\Pbottom$ quarks and for the two charged leptons,
taking advantage of the fact that the directions of quarks (jets) and charged leptons can be measured with negligible experimental resolution.
With the further assumption that also the energy of charged leptons can be measured with negligible experimental resolution,
the integration over $d\Ehat_{\Plepton^{+}}$ and $d\Ehat_{\Plepton^{-}}$ can be carried out trivially too.
We shall only consider events that pass the event selection criteria, \ie for which the indicator function $\Omega(\vecy)$ is equal to $1$.
For simplicity, we neglect the effect of the efficiency $\epsilon_{i}(\vecyhat)$ and of the acceptance $\mathcal{A}_{i}$.
With these assumptions and upon inserting the expressions for the TF given by Eqs.~(\ref{eq:TF_ell}),~(\ref{eq:TF_b}), and~(\ref{eq:TF_f}) in the appendix
into Eq.~(\ref{eq:PS_inPolarCoordinates}), we obtain:
\begin{linenowrapper}
\begin{align}
w_{i}(\vecy) 
% = & \frac{1}{2^{24} \, \pi^{18} \, \sigma_{i} \, E_{\Plepton^{+}} \, E_{\Plepton^{-}}} \, \int \, d\xhat_{a} \, d\xhat_{b} \,
%\frac{d\Ehat_{\Pbottom}}{\Ehat_{\Pbottom}} \, \frac{d\Ehat_{\APbottom}}{\Ehat_{\APbottom}} \, \frac{d^{3}\vecphat_{\Pnu}}{\Ehat_{\Pnu}} \, \frac{d^{3}\vecphat_{\APnu}}{\Ehat_{\APnu}} \,
%\frac{f(\xhat_{a}, Q) \, f(\xhat_{b}, Q)}{2 \, \xhat_{a} \, \xhat_{b} \, s} \nonumber \\
% & \quad \cdot \, (2 \, \pi)^{4} \, \delta\left( \xhat_{a} \, \Ehat_{a} + \xhat_{b} \, \Ehat_{b} - \sum_{k}^{6} \Ehat_{(k)}\right) \, 
%\delta^{3}\left( \xhat_{a} \, \vecphat^{a} + \xhat_{b} \, \vecphat^{b} - \sum_{k}^{6} \vecphat^{(k)}\right) \nonumber \\
% & \quad \cdot \, \vert \mathcal{M}_{i}(\vecphat) \vert^{2} \, \frac{\betahat_{\Pbottom} \, \Ehat_{\Pbottom}^{2}}{\beta_{\Pbottom} \, E_{\Pbottom}^{2}} \, W(E_{\Pbottom}|\Ehat_{\Pbottom}) \, 
%\frac{\betahat_{\APbottom} \, \Ehat_{\APbottom}^{2}}{\beta_{\APbottom} \, E_{\APbottom}^{2}} \, W(E_{\APbottom}|\Ehat_{\APbottom}) \nonumber \\
 = & \frac{1}{2^{21} \, \pi^{14} \, \sigma_{i} \, E_{\Plepton^{+}} \, E_{\Plepton^{-}} \, E_{\Pbottom} \, E_{\APbottom}} \, \int \, d\xhat_{a} \, d\xhat_{b} \,
d\Ehat_{\Pbottom} \, d\Ehat_{\APbottom} \, \frac{d^{3}\vecphat_{\Pnu}}{\Ehat_{\Pnu}} \, \frac{d^{3}\vecphat_{\APnu}}{\Ehat_{\APnu}} \,
\frac{f(\xhat_{a}, Q) \, f(\xhat_{b}, Q)}{\xhat_{a} \, \xhat_{b} \, s} \nonumber \\
 & \quad \cdot \, \delta\left( \xhat_{a} \, \Ehat_{a} + \xhat_{b} \, \Ehat_{b} - \sum_{k}^{6} \Ehat_{(k)}\right) \,
\delta^{3}\left( \xhat_{a} \, \vecphat^{a} + \xhat_{b} \, \vecphat^{b} - \sum_{k}^{6} \vecphat^{(k)}\right) \nonumber \\
 & \quad \cdot \, \vert \mathcal{M}_{i}(\vecphat) \vert^{2}\, \frac{\betahat_{\Pbottom} \, \Ehat_{\Pbottom}}{\beta_{\Pbottom} \, E_{\Pbottom}} \, W(E_{\Pbottom}|\Ehat_{\Pbottom}) \, 
\frac{\betahat_{\APbottom} \, \Ehat_{\APbottom}}{\beta_{\APbottom} \, E_{\APbottom}} \, W(E_{\APbottom}|\Ehat_{\APbottom}) \, .
\label{eq:mem2}
\end{align}
\end{linenowrapper}
The terms $\frac{\betahat_{\Pbottom} \, \Ehat_{\Pbottom}}{\beta_{\Pbottom} \, E_{\Pbottom}}$ and $\frac{\betahat_{\APbottom} \, \Ehat_{\APbottom}}{\beta_{\APbottom} \, E_{\APbottom}}$ 
arise because the integration over the PS elements $d^{3}\vecphat$ of the $\Pbottom$ and $\APbottom$ quarks yields a factor $\betahat \, \Ehat^{2} \, \sin\thetahat$,
while the normalization of the TF yields a factor $\frac{1}{\beta \, E^{2} \, \sin\theta}$, \cf Eq.~(\ref{eq:TF_f}).
The terms $\sin\thetahat$ and $\frac{1}{\sin\theta}$ cancel, due to the presence of the $\delta$-function $\delta(\theta - \thetahat)$ in the integrand, \cf Eq.~(\ref{eq:TF_b}).
No similar terms arise for the charged leptons, as the TF for charged leptons demand $\betahat = \beta$, $\Ehat = E$, and $\thetahat = \theta$, \cf Eq.~(\ref{eq:TF_ell}).

We simplify the four-dimensional $\delta$-function 
$\delta( \xhat_{a} \, \Ehat_{a} + \xhat_{b} \, \Ehat_{b} - \sum_{k}^{6} \Ehat_{(k)}) \cdot \delta^{3}( \xhat_{a} \, \vecphat^{a} + \xhat_{b} \, \vecphat^{b} - \sum_{k}^{6} \vecphat^{(k)})$
by assuming the momentum vectors of the colliding protons to be aligned in direction parallel and anti-parallel to the beam axis 
and neglecting the small transverse momenta of the partons within the protons as well as parton masses.
With this assumption, we can eliminate the energy and longitudinal momentum components of the $\delta$-function 
and solve for the Bjorken scaling variables $\xhat_{a}$ and $\xhat_{b}$ as function of the energies and longitudinal momenta of the particles in the final state.
This yields:
\begin{linenowrapper}
\begin{equation}
\xhat_{a} = \frac{1}{\sqrt{s}} \, \sum_{k}^{6} \left( \Ehat_{(k)} + \pZhat^{(k)} \right) \quad \mbox{ and } \quad
\xhat_{b} = \frac{1}{\sqrt{s}} \, \sum_{k}^{6} \left( \Ehat_{(k)} - \pZhat^{(k)} \right) \, .
\label{eq:Bjorkenx}
\end{equation}
\end{linenowrapper}

For the purpose of eliminating the transverse momentum components of the four-dimensional $\delta$-function,
we follow the approach of Ref.~\cite{SVfitMEM}.
The approach is based on introducing the ``hadronic recoil'', denoted by the symbol $\rho$, as a means to account for QCD radiation,
which causes additional jets to be produced besides the two $\Pbottom$-jets that originate from the decay of the $\PHiggs$ boson (in signal events) 
or from the decay of the two top quarks (in background events).
As detailed in Ref.~\cite{Alwall:2010cq}, significant amounts of QCD radiation, in particular initial-state radiation (ISR),
are a typical feature of most signal and background processes at the LHC.
The longitudinal momentum of the additional jets produced by QCD radiation alters the relations for $\xhat_{a}$ and $\xhat_{b}$ somewhat,
compared to the values given by Eq.~(\ref{eq:Bjorkenx}).
We expect the effect of QCD radiation on the energy and longitudinal momentum components to be small and thus neglect it.
The effect on the transverse momentum balance is important, however,
as QCD radiation distorts the kinematic relations that would be expected to hold in the absence of such radiation.
As a consequence, the $\delta$-functions that ensure the conservation of momentum in the transverse plane need to be modified. 
Their modified form reads: 
$\delta( \pXhat^{\rho} + \sum_{k}^{6} \pXhat^{(k)})$ and $\delta( \pYhat^{\rho} + \sum_{k}^{6} \pYhat^{(k)})$,
where $\pXhat^{\rho}$ and $\pYhat^{\rho}$ denote the true value of the momentum of the hadronic recoil $\rho$ in $x$ and $y$ direction, respectively.
They imply the relations:
\begin{linenowrapper}
\begin{equation}
\pXhat^{\rho} = - \left( \pXhat^{\Pbottom} + \pXhat^{\APbottom} + \pXhat^{\Plepton^{+}} + \pXhat^{\Pnu} + \pXhat^{\Plepton^{-}} + \pXhat^{\APnu} \right) \, \mbox{ and } \,
\pYhat^{\rho} = - \left( \pYhat^{\Pbottom} + \pYhat^{\APbottom} + \pYhat^{\Plepton^{+}} + \pYhat^{\Pnu} + \pYhat^{\Plepton^{-}} + \pYhat^{\APnu} \right) \, .
\label{eq:hadRecoil_true}
\end{equation}
\end{linenowrapper}
The corresponding relations for the measured momenta read:
\begin{linenowrapper}
\begin{equation}
\pX^{\rho} = - \left( \pX^{\Pbottom} + \pX^{\APbottom} + \pX^{\Plepton^{+}} + \pX^{\Plepton^{-}} + \METx \right) \, \mbox{ and } \,
\pY^{\rho} = - \left( \pY^{\Pbottom} + \pY^{\APbottom} + \pY^{\Plepton^{+}} + \pY^{\Plepton^{-}} + \METy \right) \, .
\label{eq:hadRecoil}
\end{equation}
\end{linenowrapper}
We use Eq.~(\ref{eq:hadRecoil}) to compute the measured values of $\pX^{\rho}$ and $\pY^{\rho}$, 
given the measured momenta of the two $\Pbottom$-jets, of the two charged leptons, and of the measured $\vecMET$.
The experimental resolution on $\pX^{\rho}$ and $\pY^{\rho}$ is accounted for by introducing a TF for the hadronic recoil into the integrand of Eq.~(\ref{eq:mem2}).
We assume that the resolution on the transverse momentum components of $\rho$ follows a two-dimensional normal distribution:
\begin{linenowrapper}
\begin{equation}
W_{\rho}( \pX^{\rho},\pY^{\rho} | \pXhat^{\rho},\pYhat^{\rho} ) = 
 \frac{1}{2\pi \, \sqrt{\vert V \vert}} \, \exp \left( -\frac{1}{2}
 \left( \begin{array}{c} \pX^{\rho} - \pXhat^{\rho} \\ \pY^{\rho} - \pYhat^{\rho} \end{array} \right)^{T}
  \cdot V^{-1} \cdot
   \left( \begin{array}{c} \pX^{\rho} - \pXhat^{\rho} \\ \pY^{\rho} - \pYhat^{\rho} \end{array} \right)
 \right) \, ,
\label{eq:TF_hadRecoil}
\end{equation}
\end{linenowrapper}
where the matrix $V$ quantifies the resolution on the hadronic recoil in the transverse plane.

The CMS collaboration computes the matrix $V$ on an event-by-event basis, using an algorithm referred to as the ``$\MET$-significance'' algorithm~\cite{JME-10-009}.
Alternatively, one could determine an average resolution $\sigma_{\rho}$ for a sample of $\dihiggs$ signal and $\ttbar$ background events using the Monte Carlo simulation
and take the matrix $V$ to be $V = \sigma_{\rho}^{2} \cdot I_{2}$, where $I_{2}$ denotes the identity matrix of size $2$.
We follow the procedure detailed in Ref.~\cite{SVfitMEM} and replace the $\delta$-functions 
$\delta( \pXhat^{\rho} + \sum_{k}^{6} \pXhat^{(k)})$ and $\delta( \pYhat^{\rho} + \sum_{k}^{6} \pYhat^{(k)})$,
which ensure the momentum conservation in the transverse plane,
with the TF for the hadronic recoil, given by Eq.~(\ref{eq:TF_hadRecoil}).

A remaining issue is that we use LO ME $\mathcal{M}_{i}(\vecphat)$ for the $\PHiggs\PHiggs$ signal and for the $\ttbar$ background in Eq.~(\ref{eq:mem2}).
The LO ME for the signal (background) requires that the $\PHiggs\PHiggs$ ($\ttbar$) system has zero $\pT$, 
a condition that only holds in case the hadronic recoil has zero $\pT$.
As previously discussed, the case that the hadronic recoil has negligible $\pT$ is rare at the LHC, due to the abundance of QCD radiation.
The issue that the LO ME is only well-defined for events with zero ISR
is resolved by evaluating the ME $\mathcal{M}_{i}(\vecyhat)$ in a frame in which the $\PHiggs\PHiggs$ ($\ttbar$) system has zero $\pT$, 
to which we refer as the zero-transverse-momentum (ZTM) frame.
The Lorentz transformation of the energy $\Ehat_{(k)}$ and momenta $\vecphat^{(k)}$ in Eq.~(\ref{eq:mem2})
from the laboratory to the ZTM frame is performed using the vector $\left(-\frac{\pX^{\rho}}{\pT^{\rho}},-\frac{\pY^{\rho}}{\pT^{\rho}},0\right)$ as the boost vector.

Eliminating the energy and longitudinal momentum components of the four-dimensional $\delta$-function 
$\delta( \xhat_{a} \, \Ehat_{a} + \xhat_{b} \, \Ehat_{b} - \sum_{k}^{6} \Ehat_{(k)}) \cdot \delta( \xhat_{a} \, \pZhat^{a} + \xhat_{b} \, \pZhat^{b} - \sum_{k}^{6} \pZhat^{(k)}) \cdot \delta( \pXhat^{\rho} + \sum_{k}^{6} \pXhat^{(k)}) \cdot \delta( \pYhat^{\rho} + \sum_{k}^{6} \pYhat^{(k)})$
by means of Eq.~(\ref{eq:Bjorkenx})
and replacing its transverse momentum components by the TF $W_{\rho}( \pX^{\rho},\pY^{\rho} | \pXhat^{\rho},\pYhat^{\rho} )$ for the hadronic recoil $\rho$,
the expression for the PD $w_{i}(\vecy)$ in Eq.~(\ref{eq:mem2}) becomes:
\begin{linenowrapper}
\begin{align}
w_{i}(\vecy) 
% = & \frac{1}{2^{21} \, \pi^{14} \, \sigma_{i} \, E_{\Plepton^{+}} \, E_{\Plepton^{-}} \, E_{\Pbottom} \, E_{\APbottom}} \, \int \, 
%d\Ehat_{\Pbottom} \, d\Ehat_{\APbottom} \, \frac{d^{3}\vecphat_{\Pnu}}{\Ehat_{\Pnu}} \, \frac{d^{3}\vecphat_{\APnu}}{\Ehat_{\APnu}} \,
%\frac{f(\xhat_{a}, Q) \, f(\xhat_{b}, Q)}{\xhat_{a} \, \xhat_{b} \, s} \nonumber \\
% & \quad \cdot \, \vert \mathcal{M}_{i}(\vecphat) \vert^{2} \, 
%\frac{\betahat_{\Pbottom} \, \Ehat_{\Pbottom}}{\beta_{\Pbottom} \, E_{\Pbottom}} \, W(E_{\Pbottom}|\Ehat_{\Pbottom}) \, 
%\frac{\betahat_{\APbottom} \, \Ehat_{\APbottom}}{\beta_{\APbottom} \, E_{\APbottom}} \, W(E_{\APbottom}|\Ehat_{\APbottom}) \, W_{\rho}( \pX^{\rho},\pY^{\rho} | \pXhat^{\rho},\pYhat^{\rho} ) \nonumber \\
 = & \frac{1}{2^{21} \, \pi^{14} \, \sigma_{i} \, E_{\Plepton^{+}} \, E_{\Plepton^{-}} \, E_{\Pbottom} \, E_{\APbottom}} \, \int \, 
d\Ehat_{\Pbottom} \, d\Ehat_{\APbottom} \, d\Ehat_{\Pnu} \, d\thetahat_{\Pnu} \, d\phihat_{\Pnu} \, d\Ehat_{\APnu} \, d\thetahat_{\APnu} \, d\phihat_{\APnu} \nonumber \\
 & \quad \cdot \, \betahat_{\Pnu} \, \Ehat_{\Pnu} \, \sin\thetahat_{\Pnu} \, 
\betahat_{\APnu} \, \Ehat_{\APnu} \, \sin\thetahat_{\APnu} \, 
\frac{f(\xhat_{a}, Q) \, f(\xhat_{b}, Q)}{\xhat_{a} \, \xhat_{b} \, s} \nonumber \\
 & \quad \cdot \, \vert \mathcal{M}_{i}(\vecphat) \vert^{2} \, 
\frac{\betahat_{\Pbottom} \, \Ehat_{\Pbottom}}{\beta_{\Pbottom} \, E_{\Pbottom}} \, W(E_{\Pbottom}|\Ehat_{\Pbottom}) \, 
\frac{\betahat_{\APbottom} \, \Ehat_{\APbottom}}{\beta_{\APbottom} \, E_{\APbottom}} \, W(E_{\APbottom}|\Ehat_{\APbottom}) \, W_{\rho}( \pX^{\rho},\pY^{\rho} | \pXhat^{\rho},\pYhat^{\rho} ) \, .
\label{eq:mem3}
\end{align}
\end{linenowrapper}
The expression in Eq.~(\ref{eq:mem3}) concludes our discussion of analytic transformations of the expressions for the PD $w_{i}(\vecy)$ 
that are common to the signal as well as to the background hypothesis.

A few more analytic transformations need to be performed to handle the presence of Breit-Wigner (BW) propagators in the ME $\mathcal{M}_{i}(\vecphat)$,
as the presence of these propagators represent an obstacle for the numeric integration of Eq.~(\ref{eq:mem3}).
The effect of the BW propagators is that only narrow slices in the $6$-particle PS yield sizeable contributions to the integral,
namely the regions where the $6$ final state particles satisfy certain mass constraints.
The mass constraints arise from the presence of on-shell $\PHiggs$ bosons, $\PW$ bosons, and top quarks in the decay chains
$\PHiggs\PHiggs \to \Pbottom\APbottom\PW\PW\virt \to \Pbottom\APbottom \, \ellPlusnu\ellMinusnu$ and
$\ttbar \to \Pbottom\PW\APbottom\PW \to \Pbottom\ellPlusnu \, \APbottom\ellMinusnu$.
Their presence renders the numeric integration inefficient, unless the mass constraints are treated analytically. 
We use the narrow-width approximation (NWA)~\cite{NWA} to handle the mass constraints and replace the BW propagators by $\delta$-functions.
The NWA has the effect of restricting the numerical integration to the narrow slices in the $6$-particle PS where the mass constraints are satisfied
and the ME $\mathcal{M}_{i}(\vecphat)$ yields a sizeable contribution to the integral.
The analytic transformations that are needed to handle the BW propagators differ for the signal and for the background hypothesis,
reflecting the presence of different resonances in the respective decay chains.
The transformations that are specific to the signal hypothesis are detailed in Section~\ref{sec:mem_signal},
while those specific to the background hypothesis are presented in Section~\ref{sec:mem_background}.

Finally, the numeric integration is performed using the VAMP algorithm~\cite{VAMP}, a variant of the popular VEGAS algorithm~\cite{VEGAS},
which has been optimized for the case of integrating multimodal functions that typically appear in the integration of ME over regions in PS.
We use $2500$ evaluations of the integrand when computing the PD $w_{0}(\vecy)$ for the signal hypothesis 
and $25000$ evaluations of the integrand for the computation of the PD $w_{1}(\vecy)$ for the background hypothesis.
The number of evaluations has been chosen such that the computation of $w_{0}(\vecy)$ and $w_{1}(\vecy)$ take approximately the same time
and the computation of the likelihood ratio $P(\vecy)$ takes about one minute per event,
using a single core of a $2.30$~GHz Intel\TReg~Xeon\TReg~E5-2695V3 processor.


\subsection{Analytic transformations specific to the signal hypothesis}
\label{sec:mem_signal}

When evaluating the integrand in Eq.~(\ref{eq:mem3}) for the signal hypothesis,
only those points in the $6$-particle PS provide a sizeable contribution to the value of the integral $w_{0}(\vecy)$
which satisfy the following conditions:
\begin{itemize}
\item The mass of the $2$-particle system comprised of the two $\Pbottom$ quarks equals $m_{\PHiggs} = 125.1$~\GeV~\cite{HIG-14-042}.
\item The mass of the $2$-particle system comprised of the charged lepton and of the neutrino, which originate from the decay of the on-shell $\PW$ boson, equals $m_{\PW} = 80.4$~\GeV~\cite{PDG}.
\item The mass of the $4$-particle system comprised of the two charged leptons and of the two neutrinos equals $m_{\PHiggs}$.
\end{itemize}

We formally introduce these mass constraints by inserting three $\delta$-functions $\delta\left( g(x) \right)$ into the integrand of Eq.~(\ref{eq:mem3}).
The procedure is explained in Section~\ref{sec:appendix_mass_constraints} of the appendix.
More specifically, we insert
one $\delta$-function of the type $g(\Ehat_{\APbottom})$ given by Eq.~(\ref{eq:bEn_Hbb1}), 
one of the type $g(\Ehat_{\Pnu})$ given by Eq.~(\ref{eq:nuEn_Wlnu1}), and one of the type $g(\Ehat_{\nuStar})$ given by Eq.~(\ref{eq:nuEn_Hww1}) into the integrand of Eq.~(\ref{eq:mem3}).
We denote the charged lepton and the neutrino originating from the decay of the off-shell $\PW$ boson, which can be either the $\PW^{+}$ or the $\PW^{-}$, by an asterisk.
The charged lepton and the neutrino that are referred to without asterisks are subject to the $\PW$ mass constraint.

After solving for the $\delta$-functions analytically, as detailed in Sections~\ref{sec:appendix_bEn_Hbb}, ~\ref{sec:appendix_nuEn_Wlnu}, and~\ref{sec:appendix_nuEn_Hww} of the appendix,
the resulting expression for the PD $w_{0}(\vecy)$ of the signal hypothesis reads:
\begin{linenowrapper}
\begin{align}
w_{0}(\vecy) 
% = & \frac{(m_{\PHiggs} \, \Gamma_{\PHiggs})^{2} \, m_{\PW} \, \Gamma_{\PW}}{2^{21} \, \pi^{14} \, \sigma_{0} \, E_{\Plepton} \, E_{\ellStar} \, E_{\Pbottom} \, E_{\APbottom}} \, \int \,
%d\Ehat_{\Pbottom} \, d\thetahat_{\Pnu} \, d\phihat_{\Pnu} \, d\thetahat_{\nuStar} \, d\phihat_{\nuStar}  \nonumber \\
% & \quad \cdot \, \underbrace{\betahat_{\Pnu}}_{= 1} \, \underbrace{\Ehat_{\Pnu} \, \sin\thetahat_{\Pnu}}_{= \pThat^{\Pnu}} \, 
%  \underbrace{\betahat_{\nuStar}}_{= 1} \, \underbrace{\Ehat_{\nuStar} \, \sin\thetahat_{\nuStar}}_{= \pThat^{\nuStar}} \, 
%\frac{f(\xhat_{a}, Q) \, f(\xhat_{b}, Q)}{\xhat_{a} \, \xhat_{b} \, s} \nonumber \\
% & \quad \cdot \, \vert \mathcal{M}_{0}(\vecphat) \vert^{2} \, 
%\frac{\betahat_{\Pbottom} \, \Ehat_{\Pbottom}}{\beta_{\Pbottom} \, E_{\Pbottom}} \, W(E_{\Pbottom}|\Ehat_{\Pbottom}) \, 
%\frac{\betahat_{\APbottom} \, \Ehat_{\APbottom}}{\beta_{\APbottom} \, E_{\APbottom}} \, W(E_{\APbottom}|\Ehat_{\APbottom}) \,
%W_{\rho}( \pX^{\rho},\pY^{\rho} | \pXhat^{\rho},\pYhat^{\rho} ) \nonumber \\
% & \quad \cdot \, \frac{1}{\Ehat_{\Pbottom} \, \left\lvert 1 - \frac{\betahat_{\Pbottom}}{\betahat_{\APbottom}} \, \cos\sphericalangle(\vece_{\Pbottom},\vece_{\APbottom}) \right\rvert} \nonumber \\
% & \quad \cdot \, \frac{1}{4 \, E_{\Plepton} \, \sin^{2}\left(\frac{\sphericalangle(\vece_{\Plepton},\vecehat_{\Pnu})}{2}\right)} \,
%\frac{1}{\Ehat_{\ellnuellStar} \left( 1 - \betahat_{\ellnuellStar} \, \cos\sphericalangle(\vecehat_{\ellnuellStar},\vecehat_{\nuStar}) \right)} \nonumber \\
 = & \frac{(m_{\PHiggs} \, \Gamma_{\PHiggs})^{2} \, m_{\PW} \, \Gamma_{\PW}}{2^{23} \, \pi^{14} \, \sigma_{0} \, s \, 
  E_{\Plepton}^{2} \, E_{\ellStar} \, \beta_{\Pbottom} \, E_{\Pbottom}^{2} \, \beta_{\APbottom} \, E_{\APbottom}^{2}} \, \int \,
d\Ehat_{\Pbottom} \, d\thetahat_{\Pnu} \, d\phihat_{\Pnu} \, d\thetahat_{\nuStar} \, d\phihat_{\nuStar} \nonumber \\
 & \quad \cdot \, \pThat^{\Pnu} \, \pThat^{\nuStar} \, 
\frac{f(\xhat_{a}, Q) \, f(\xhat_{b}, Q)}{\xhat_{a} \, \xhat_{b}} \nonumber \\
 & \quad \cdot \, \vert \mathcal{M}_{0}(\vecphat) \vert^{2} \, 
\betahat_{\Pbottom} \, W(E_{\Pbottom}|\Ehat_{\Pbottom}) \, 
\betahat_{\APbottom} \, \Ehat_{\APbottom} \, W(E_{\APbottom}|\Ehat_{\APbottom}) \,
W_{\rho}( \pX^{\rho},\pY^{\rho} | \pXhat^{\rho},\pYhat^{\rho} ) \nonumber \\
 & \quad \cdot \, \left\lvert 1 - \frac{\betahat_{\Pbottom}}{\betahat_{\APbottom}} \, \cos\sphericalangle(\vece_{\Pbottom},\vece_{\APbottom}) \right\rvert^{-1} \nonumber \\
% & \quad \cdot \, \frac{1}{\sin^{2}\left(\frac{\sphericalangle(\vece_{\Plepton},\vecehat_{\Pnu})}{2}\right)} \,
%\frac{1}{\Ehat_{\ellnuellStar} \left( 1 - \betahat_{\ellnuellStar} \, \cos\sphericalangle(\vecehat_{\ellnuellStar},\vecehat_{\nuStar}) \right)} \, ,
 & \quad \cdot \, \left( \sin^{2}\left(\frac{\sphericalangle(\vece_{\Plepton},\vecehat_{\Pnu})}{2}\right)} \,
\frac{1}{\Ehat_{\ellnuellStar} \left( 1 - \betahat_{\ellnuellStar} \, \cos\sphericalangle(\vecehat_{\ellnuellStar},\vecehat_{\nuStar}) \right) \right)^{-1} \, ,
\label{eq:mem_signal}
\end{align}
\end{linenowrapper}
with:
\begin{linenowrapper}
\begin{eqnarray}
\Ehat_{\APbottom} & = & \frac{a \, \Delta_{m_{\PHiggs}} + |b| \, \sqrt{\Delta_{m_{\PHiggs}}^{2} - (a^{2} - b^{2}) \, m_{\Pbottom}^{2}}}{a^{2} - b^{2}} \nonumber \\
\Ehat_{\Pnu} & = & \frac{m_{\PW}^{2}}{4 \, \Ehat_{\Plepton} \, \sin^{2}\left(\frac{\sphericalangle(\vece_{\Plepton},\vecehat_{\Pnu})}{2}\right)} \nonumber \\
\Ehat_{\nuStar} & = & \frac{m_{\PHiggs}^{2} - m_{\ellnuellStar}^{2}}{2 \, \Ehat_{\ellnuellStar} \, 
 \left( 1 - \betahat_{\ellnuellStar} \, \cos\sphericalangle(\vecehat_{\ellnuellStar},\vecehat_{\nuStar}) \right)} \, ,
\label{eq:mem_signal_defs}
\end{eqnarray}
\end{linenowrapper}
where:
\begin{linenowrapper}
\begin{eqnarray}
\Delta_{m_{\PHiggs}} & = & \frac{m_{\PHiggs}^{2}}{2} - m_{\Pbottom}^{2} \nonumber \\
a & = & \Ehat_{\Pbottom} \nonumber \\
%b & = & \underbrace{\sqrt{\Ehat_{\Pbottom}^{2} - m_{\Pbottom}^{2}}}_{= \betahat_{\Pbottom} \, \Ehat_{\Pbottom}} \, 
% \underbrace{\vece_{\Pbottom} \cdot \vece_{\APbottom}}_{= \cos\sphericalangle(\vece_{\Pbottom},\vece_{\APbottom})} \, 
%= \, \betahat_{\Pbottom} \, \Ehat_{\Pbottom} \, \cos\sphericalangle(\vece_{\Pbottom},\vece_{\APbottom}) \, .
b & = & \betahat_{\Pbottom} \, \Ehat_{\Pbottom} \, \cos\sphericalangle(\vece_{\Pbottom},\vece_{\APbottom}) \, .
\end{eqnarray}
\end{linenowrapper}
The integral on the RHS of Eq.~(\ref{eq:mem_signal}) is ready to be evaluated by numeric integration. 
The integral extends over the $5$ variables
 $\Ehat_{\Pbottom}$, $\thetahat_{\Pnu}$, $\phihat_{\Pnu}$, $\thetahat_{\nuStar}$, and $\phihat_{\nuStar}$.
The symbol $\vece_{k}$ refers to a unit vector in direction of particle $k$,
and the symbol $\sphericalangle(\vecehat_{k},\vecehat_{k'})$ denotes the angle between the directions of particles $k$ and $k'$.
This notation includes the case that the ``particles'' $k$ and $k'$ are systems of multiple particles,
\eg $\vecehat_{\ellnuellStar}$ denotes the direction of the momentum vector of the $3$-particle system composed of
the charged lepton and the neutrino produced in the decay of the on-shell $\PW$ boson and of the charged lepton produced in the decay of the off-shell $\PW$ boson.
The hat in the symbol $\vecehat_{\ellnuellStar}$ indicates that this direction refers to the true momenta of the neutrinos,
which are computed as function of the integration variables $\thetahat_{\Pnu}$, $\phihat_{\Pnu}$, $\thetahat_{\nuStar}$, $\phihat_{\nuStar}$ and Eq.~(\ref{eq:mem_signal_defs}).
For the charged leptons and the $\Pbottom$-jets, the true direction is equal to the measured direction,
as the direction of charged leptons and jets is measured with negligible experimental resolution.

There is one further aspect, which needs to be taken into account when computing the compatibility of a given event with the signal hypothesis,
and that is that there exists a fourfold ambiguity in associating the two measured $\Pbottom$-jets to the $\Pbottom$ and $\APbottom$ quarks 
and in associating the two measured charged leptons to the on-shell and off-shell $\PW$ bosons.
We deal with the fourfold ambiguity by evaluating the integral $w_{0}(\vecy)$ given by Eq.~(\ref{eq:mem_signal}) four times,
once for each of the four possible associations of measured $\Pbottom$-jets to the $\Pbottom$ and $\APbottom$ quarks and of the measured charged leptons to the on-shell and off-shell $\PW$ bosons,
and using the average of these four values when evaluating the LR in Eq.~(\ref{eq:memLR}).


\subsection{Analytic transformations specific to the background hypothesis}
\label{sec:mem_background}

In $\ttbar \to \Pbottom\PW\APbottom\PW \to \Pbottom\ellPlusnu \, \APbottom\ellMinusnu$ background events,
both $\PW$ bosons are on-shell. Sizeable contributions to the value of the integral $w_{1}(\vecy)$ are obtained only
for those points $\vecphat$ in the $6$-particle PS for which:
\begin{itemize}
\item The masses of the $\ellPlusnu$ as well as of the $\ellMinusnu$ system are equal to $m_{\PW} = 80.4$~\GeV~\cite{PDG}.
\item The masses of the $\Pbottom\ellPlusnu$ and $\APbottom\ellMinusnu$ systems are equal to the top quark mass of $m_{\Ptop} = 172.8$~\GeV~\cite{PDG}.
\end{itemize}

We account for these mass constraints by inserting four $\delta$-functions $\delta\left( g(x) \right)$ into the integrand of Eq.~(\ref{eq:mem3}):
two $\delta$-functions of the type $g(\Ehat_{\Pnu})$, given by Eq.~(\ref{eq:nuEn_Wlnu1}),
and two $\delta$-functions of the type $g(\Ehat_{\Pbottom})$, given by Eq.~(\ref{eq:bEn_top1}).
We denote the second $\delta$-function of the type given by Eq.~(\ref{eq:nuEn_Wlnu1}) by the symbol $g(\Ehat_{\APnu})$
and the second $\delta$-function of the type given by Eq.~(\ref{eq:bEn_top1}) by the symbol $g(\Ehat_{\APbottom})$
to indicate that they refer to the anti-neutrino and to the anti-bottom quark, which both are produced in the decay of the anti-top quark.

After solving for the $\delta$-functions analytically, following Sections~\ref{sec:appendix_nuEn_Wlnu} and~\ref{sec:appendix_bEn_top} of the appendix,
we obtain the following expression for the integral $w_{1}(\vecy)$ for the background hypothesis:
\begin{linenowrapper}
\begin{align}
w_{1}(\vecy) 
% = & \frac{(m_{\Ptop} \, \Gamma_{\Ptop})^{2} \, (m_{\PW} \, \Gamma_{\PW})^{2}}{2^{21} \, \pi^{14} \, \sigma_{1} \, E_{\Plepton^{+}} \, E_{\Plepton^{-}} \, E_{\Pbottom} \, E_{\APbottom}} \, \int \,
%d\thetahat_{\Pnu} \, d\phihat_{\Pnu} \, d\thetahat_{\APnu} \, d\phihat_{\APnu}  \nonumber \\
% & \quad \cdot \, \underbrace{\betahat_{\Pnu}}_{= 1} \, \underbrace{\Ehat_{\Pnu} \, \sin\thetahat_{\Pnu}}_{= \pThat^{\Pnu}} \, 
%  \underbrace{\betahat_{\APnu}}_{= 1} \, \underbrace{\Ehat_{\APnu} \, \sin\thetahat_{\APnu}}_{= \pThat^{\APnu}} \, 
%\frac{f(\xhat_{a}, Q) \, f(\xhat_{b}, Q)}{\xhat_{a} \, \xhat_{b} \, s} \nonumber \\
% & \quad \cdot \, \vert \mathcal{M}_{1}(\vecphat) \vert^{2} \, 
%\frac{\betahat_{\Pbottom} \, \Ehat_{\Pbottom}}{\beta_{\Pbottom} \, E_{\Pbottom}} \, W(E_{\Pbottom}|\Ehat_{\Pbottom}) \, 
%\frac{\betahat_{\APbottom} \, \Ehat_{\APbottom}}{\beta_{\APbottom} \, E_{\APbottom}} \, W(E_{\APbottom}|\Ehat_{\APbottom}) \,
%W_{\rho}( \pX^{\rho},\pY^{\rho} | \pXhat^{\rho},\pYhat^{\rho} ) \nonumber \\
% & \quad \cdot \, \frac{1}{4 \, E_{\Plepton^{+}} \, \sin^{2}\left(\frac{\sphericalangle(\vece_{\ellPlus},\vecehat_{\Pnu})}{2}\right)} \, 
%\frac{1}{4 \, E_{\Plepton^{-}} \, \sin^{2}\left(\frac{\sphericalangle(\vece_{\ellMinus},\vecehat_{\APnu})}{2}\right)} \nonumber \\
% & \quad \cdot \, \frac{1}{\Ehat_{\ellPlusnu} \, \left\lvert 1 - \frac{\betahat_{\ellPlusnu}}{\betahat_{\Pbottom}} \, \cos\sphericalangle(\vecehat_{\ellPlusnu},\vece_{\Pbottom}) \right\rvert} \,
%\frac{1}{\Ehat_{\ellMinusnu} \, \left\lvert 1 - \frac{\betahat_{\ellMinusnu}}{\betahat_{\APbottom}} \, \cos\sphericalangle(\vecehat_{\ellMinusnu},\vece_{\APbottom}) \right\rvert} \nonumber \\
 = & \frac{(m_{\Ptop} \, \Gamma_{\Ptop})^{2} \, (m_{\PW} \, \Gamma_{\PW})^{2}}{2^{25} \, \pi^{14} \, \sigma_{1} \, s \, 
  E_{\Plepton^{+}}^{2} \, E_{\Plepton^{-}}^{2} \, \beta_{\Pbottom} \, E_{\Pbottom}^{2} \, \beta_{\APbottom} \, E_{\APbottom}^{2}} \, \int \,
d\thetahat_{\Pnu} \, d\phihat_{\Pnu} \, d\thetahat_{\APnu} \, d\phihat_{\APnu}  \nonumber \\
 & \quad \cdot \, \pThat^{\Pnu} \, \pThat^{\APnu} \,
\frac{f(\xhat_{a}, Q) \, f(\xhat_{b}, Q)}{\xhat_{a} \, \xhat_{b}} \nonumber \\
 & \quad \cdot \, \vert \mathcal{M}_{1}(\vecphat) \vert^{2} \, 
\betahat_{\Pbottom} \, \Ehat_{\Pbottom} \, W(E_{\Pbottom}|\Ehat_{\Pbottom}) \, 
\betahat_{\APbottom} \, \Ehat_{\APbottom} \, W(E_{\APbottom}|\Ehat_{\APbottom}) \,
W_{\rho}( \pX^{\rho},\pY^{\rho} | \pXhat^{\rho},\pYhat^{\rho} ) \nonumber \\
% & \quad \cdot \, \frac{1}{\sin^{2}\left(\frac{\sphericalangle(\vece_{\ellPlus},\vecehat_{\Pnu})}{2}\right)} \, 
%\frac{1}{\sin^{2}\left(\frac{\sphericalangle(\vece_{\ellMinus},\vecehat_{\APnu})}{2}\right)} \nonumber \\
% & \quad \cdot \, \frac{1}{\Ehat_{\ellPlusnu} \, \left\lvert 1 - \frac{\betahat_{\ellPlusnu}}{\betahat_{\Pbottom}} \, \cos\sphericalangle(\vecehat_{\ellPlusnu},\vece_{\Pbottom}) \right\rvert} \,
%\frac{1}{\Ehat_{\ellMinusnu} \, \left\lvert 1 - \frac{\betahat_{\ellMinusnu}}{\betahat_{\APbottom}} \, \cos\sphericalangle(\vecehat_{\ellMinusnu},\vece_{\APbottom}) \right\rvert} \, ,
 & \quad \cdot \, \left( \sin^{2}\left(\frac{\sphericalangle(\vece_{\ellPlus},\vecehat_{\Pnu})}{2}\right)} \, 
\frac{1}{\sin^{2}\left(\frac{\sphericalangle(\vece_{\ellMinus},\vecehat_{\APnu})}{2}\right) \right)^{-1} \nonumber \\
 & \quad \cdot \, \left( \Ehat_{\ellPlusnu} \, \left\lvert 1 - \frac{\betahat_{\ellPlusnu}}{\betahat_{\Pbottom}} \, \cos\sphericalangle(\vecehat_{\ellPlusnu},\vece_{\Pbottom}) \right\rvert} \,
\frac{1}{\Ehat_{\ellMinusnu} \, \left\lvert 1 - \frac{\betahat_{\ellMinusnu}}{\betahat_{\APbottom}} \, \cos\sphericalangle(\vecehat_{\ellMinusnu},\vece_{\APbottom}) \right\rvert \right)^{-1} \, ,
\label{eq:mem_background}
\end{align}
\end{linenowrapper}
with:
\begin{linenowrapper}
\begin{eqnarray}
\Ehat_{\Pbottom} & = & \frac{a_{\Ptop} \, \Delta_{m_{\Ptop}}
 + |b_{\Ptop}| \, \sqrt{\Delta_{m_{\Ptop}}^{2} - (a_{\Ptop}^{2} - b_{\Ptop}^{2}) \, m_{\Pbottom}^{2}}}{a_{\Ptop}^{2} - b_{\Ptop}^{2}} \nonumber \\
\Ehat_{\APbottom} & = & \frac{a_{\APtop} \, \Delta_{m_{\Ptop}}
 + |b_{\APtop}| \, \sqrt{\Delta_{m_{\Ptop}}^{2} - (a_{\APtop}^{2} - b_{\APtop}^{2}) \, m_{\Pbottom}^{2}}}{a_{\APtop}^{2} - b_{\APtop}^{2}} \nonumber \\
\Ehat_{\Pnu} & = & \frac{m_{\PW}^{2}}{4 \, \Ehat_{\ellPlus} \, \sin^{2}\left(\frac{\sphericalangle(\vece_{\ellPlus},\vecehat_{\Pnu})}{2}\right)} \nonumber \\
\Ehat_{\APnu} & = & \frac{m_{\PW}^{2}}{4 \, \Ehat_{\ellMinus} \, \sin^{2}\left(\frac{\sphericalangle(\vece_{\ellMinus},\vecehat_{\APnu})}{2}\right)} \, ,
\label{eq:mem_background_defs}
\end{eqnarray}
\end{linenowrapper}
where:
\begin{linenowrapper}
\begin{eqnarray}
\Delta_{m_{\Ptop}} & = & \frac{m_{\Ptop}^{2} - m_{\Pbottom}^{2} - m_{\PW}^{2}}{2} \nonumber \\
a_{\Ptop} & = & \Ehat_{\ellPlusnu} \nonumber \\
%b_{\Ptop} & = & \sqrt{\Ehat_{\ellPlusnu}^{2} - m_{\PW}^{2}} \, 
% \underbrace{\vecehat_{\ellPlusnu} \cdot \vece_{\Pbottom}}_{= \cos\sphericalangle(\vecehat_{\ellPlusnu},\vece_{\Pbottom})} \, 
%= \, \sqrt{\Ehat_{\ellPlusnu}^{2} - m_{\PW}^{2}} \, \cos\sphericalangle(\vecehat_{\ellPlusnu},\vece_{\Pbottom}) \nonumber \\
b_{\Ptop} & = & \sqrt{\Ehat_{\ellPlusnu}^{2} - m_{\PW}^{2}} \, \cos\sphericalangle(\vecehat_{\ellPlusnu},\vece_{\Pbottom}) \nonumber \\
a_{\APtop} & = & \Ehat_{\ellMinusnu} \nonumber \\
%b_{\APtop} & = & \sqrt{\Ehat_{\ellMinusnu}^{2} - m_{\PW}^{2}} \, 
% \underbrace{\vecehat_{\ellMinusnu} \cdot \vece_{\APbottom}}_{= \cos\sphericalangle(\vecehat_{\ellMinusnu},\vece_{\APbottom})} \,
%= \, \sqrt{\Ehat_{\ellMinusnu}^{2} - m_{\PW}^{2}} \, \cos\sphericalangle(\vecehat_{\ellMinusnu},\vece_{\APbottom}) \, .
b_{\APtop} & = & \sqrt{\Ehat_{\ellMinusnu}^{2} - m_{\PW}^{2}} \, \cos\sphericalangle(\vecehat_{\ellMinusnu},\vece_{\APbottom}) \, .
\end{eqnarray}
\end{linenowrapper}
The integral given by Eq.~(\ref{eq:mem_background}) extends over $4$ remaining variables,
which are integrated numerically: $\thetahat_{\Pnu}$, $\phihat_{\Pnu}$, $\thetahat_{\APnu}$, and $\phihat_{\APnu}$.
The symbol $\ellPlusnu$ ($\ellMinusnu$) refers to the true direction of the $\PW^{+}$ ($\PW^{-}$) boson,
which are computed by summing the momenta of the lepton of positive (negative) charge and of the neutrino (anti-neutrino).
The neutrino and anti-neutrino momenta are computed as function of the integration variables $\thetahat_{\Pnu}$, $\phihat_{\Pnu}$, $\thetahat_{\APnu}$, $\phihat_{\APnu}$ and Eq.~(\ref{eq:mem_background_defs}).

When evaluating the compatibility of a given event with the background hypothesis,
there exists a twofold ambiguity in associating the two measured $\Pbottom$-jets to the $\Pbottom$ and $\APbottom$ quarks.
We deal with this ambiguity by evaluating the integral $w_{1}(\vecy)$ given by Eq.~(\ref{eq:mem_signal}) two times,
corresponding to the two possible associations of the measured $\Pbottom$-jets to the $\Pbottom$ and $\APbottom$ quarks.
In contrast to the signal hypothesis,
there is no ambiguity in associating the two measured leptons to the two $\PW$ bosons,
as in $\ttbar$ background events both $\PW$ bosons are on-shell,
and the measurement of the lepton charge allows for a unique association of each charged lepton to either the $\PW^{+}$ or the $\PW^{-}$ boson.
